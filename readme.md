
# Документация проекта

## Основные возможности

| Раздел                | Описание краткой функции                                                                                                                                                                                                                                                                                     | Где реализовано                                          |
|-------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------|
| Организации             | Администратор может создавать организации и просматривать список резидентов. Статус организации (например, `approved`) может быть обновлён администратором; при одобрении руководитель организации получает роль `COMPANY_MANAGER`[1]. Есть публичный метод для получения списка утверждённых организаций для фильтров[2]. | `apps/server/src/orpc/routers/organization.ts`             |
| Вакансии                | HR или менеджер компании может создавать вакансии, редактировать и удалять их, а администратор — изменять статус. Публичные методы позволяют просматривать одну или все вакансии и сортировать их по дате. Отдельный метод вычисляет «рейтинг совместимости» на основе совпадения навыков соискателя и требований вакансии[3]. | `apps/server/src/orpc/routers/vacancy.ts`                  |
| Резюме                  | Пользователи могут создавать и обновлять резюме, получать список своих резюме и просматривать конкретные. HR имеет доступ к поиску резюме по навыкам или специальности. Кеширование Redis используется для ускорения запросов[4].                                                                                       | `apps/server/src/orpc/routers/resume.ts`                   |
| Заявки (Requests)       | Пользователь может подать заявку на вакансию; HR получает список заявок по своим вакансиям, фильтрует их по статусу и может менять статус на `pending`, `accepted` или `rejected`. Удаление заявки помечает её как удалённую, а не удаляет из базы[5].                                                                   | `apps/server/src/orpc/routers/request.ts`                  |
| Ответы (Responses)      | После подачи заявки HR или пользователь может оставить ответ, который одновременно обновляет статус заявки. Можно получить список всех ответов или посмотреть конкретный ответ по ID[6].                                                                                                                            | `apps/server/src/orpc/routers/response.ts`                 |
| Файлы                   | Сервис позволяет загружать и скачивать файлы (например, документы к заявке) через S3-совместимое хранилище. Для загрузки используется путь `uploadFile`, а для скачивания – `getFile`[7].                                                                                                                            | `apps/server/src/orpc/routers/file.ts`                     |

---

## Дополнительные функции

### Аутентификация и роли
Приложение использует пакет **better-auth** для регистрации и логина.  
Роли:
- `ADMIN`
- `HR`
- `USER`
- `COMPANY_MANAGER`

Роли определяют доступ к методам API.  
Для каждого вызова в роутерах задаются ограничения:
- `protectedProcedure` — для авторизованных пользователей
- `roleProcedure` — для конкретных ролей.

### Кеширование
Большие выборки (списки резюме, вакансий, заявок) кешируются в Redis для ускорения работы.  
Сервис `InvalidateCached` обновляет кеш после операций создания или обновления.

### Подбор резюме по навыкам
HR может искать резюме по списку навыков или специальности.  
Запросы формируются через `innerJoin` таблиц `resumes` и `skillsToResumes` в базе данных[8].

---

## Структура репозитория

Проект представляет собой **монорепозиторий** с разделением на:
- Приложение (frontend и backend)
- Набор библиотек общего назначения.


# Запуск:

1.  **Хостим Postgres**  
2.  **Хостим Redis**  
3. **Хостим S3 compatible storage** (например Minio)  
4.  **Заполняем env в `docker-compose.yml`**

```
VITE_SERVER_URL: домен бека публичный с протоколом
VITE_SERVER_URL_INTERNAL: домен бека внутренний (например в этом compose будет http://server:3000)
DATABASE_URL: postgresql://postgres:postgres@localhost:5432/postgres
REDIS_URL: redis://default:password@localhost:6379/0
S3_ACCESS_KEY: access_key s3
S3_BUCKET: s3 bucket
S3_ENDPOINT: s3 endpoint
S3_REGION: s3 region
S3_SECRET_KEY: s3 secret key
CORS_ORIGIN: домен фронта с протоколом
BETTER_AUTH_SECRET: ключ для jwt (любая строка)
BETTER_AUTH_URL: домен публичный с протоколом
MAIN_ADMIN_EMAIL: почта админа
MAIN_ADMIN_PASSWORD: пароль админа
```

5. Добавить файл `.env` в `packages/database/.env`  
```
DATABASE_URL="postgresql://postgres:postgres@localhost:5432/postgres"
```
(данные от Postgres заменить)

6. Установить [https://bun.sh](https://bun.sh)  
7. В корне проекта написать `bun install`  
8. Затем написать `bun run db:push`  
9. Запустить compose через команду `docker compose up`  
10. Готово!

---

## Архитектура и структура проекта

Проект организован как **монорепозиторий**.  
В корне находятся файлы конфигурации (`docker-compose.yml`, `package.json`) и две основные папки: `apps` и `packages`.

### Приложения (apps)
- `apps/server` — бэкенд, написанный на **Bun** с использованием фреймворка **Elysia**. Сервер использует PostgreSQL в связке с Drizzle ORM для работы с данными, подключается к Redis и хранилищу S3/Minio. В каталоге `src` размещён исходный код, в `package.json` — скрипты (`bun run dev`, `bun run build`) и зависимости. Для контейнеризации есть `Dockerfile`.
- `apps/web` — веб‑клиент. Собран на **React 19** и **Vite** с использованием **TanStack Start** (React Router/Query) для маршрутизации и управления состояниями. В интерфейсе применяются **Tailwind CSS** и компоненты **Radix UI**. Папка `src` содержит код клиента, `public` — статические ресурсы; `package.json` описывает зависимости.

---

## Пакеты (packages)

- `database` — модуль для работы с БД: содержит схемы и миграции Drizzle ORM и скрипты для выполнения миграций (`db:push`, `db:generate`, `db:migrate`).
- `env` — типобезопасная работа с переменными окружения на основе zod.
- `files` — функции для загрузки и обработки файлов: взаимодействие с S3/Minio, преобразование изображений через sharp, а также связь с пакетом database.
- `logger` — конфигурация логирования на основе winston.
- `redis` — вспомогательный модуль для подключения к Redis.
- `shared` — общие типы и схемы (на zod), разделяемые между сервером и клиентом. Подключает пакет database.
- `typescript-config` — общие настройки TypeScript, применяемые в репозитории.
- `email` — в текущей версии содержит только скомпилированные файлы; предполагается, что здесь будет логика отправки e‑mail.

---

## Технологический стек

- **Bun** — серверный рантайм и менеджер пакетов.  
- **Elysia** — лёгкий HTTP‑фреймворк для Bun.  
- **PostgreSQL + Drizzle ORM** — хранение и манипулирование данными.  
- **Redis** — in‑memory хранилище для кеширования и очередей.  
- **S3/Minio** — объектное хранилище для файлов и резервных копий.  
- **React 19 + Vite** — клиентская часть.  
- **TanStack Router/Query (React Start)** — маршрутизация и управление состояниями на клиенте.  
- **Radix UI** и **Tailwind CSS** — библиотека компонентов и утилитарная CSS‑система.  
- **Zod** — декларативная валидация данных и схемы.  
- **Winston** — логирование на сервере.
